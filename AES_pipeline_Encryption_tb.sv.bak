`timescale 1ns/1ps

module tb_AES_pipeline_Encryption;

  // ------------------------
  // Clock & Reset
  // ------------------------
  logic clk;
  logic reset;

  always #5 clk = ~clk; // 100 MHz clock (chu kỳ 10 ns)

  // ------------------------
  // DUT I/O
  // ------------------------
  logic [127:0] plaintext;
  logic [127:0] key;
  logic [127:0] cypher;

  // ------------------------
  // DUT Instance
  // ------------------------
  AES_pipeline_Encryption uut (
      .clk(clk),
      .reset(reset),
      .plaintext(plaintext),
      .key(key),
      .cypher(cypher)
  );

  // ------------------------
  // Test Stimulus
  // ------------------------
  integer i;

  initial begin
    $display("# Time\tCycle\tPlaintext_in\t\t\t\tCypher_out");
    $monitor("%0t\t%0d\t%032h\t%032h", $time, i, plaintext, cypher);

    clk = 0;
    reset = 1;
    plaintext = 128'h0;
    key = 128'h000102030405060708090A0B0C0D0E0F;

    #20;
    reset = 0;

    // Feed 10 plaintext blocks liên tục (mô phỏng dữ liệu ảnh/video)
    for (i = 0; i < 10; i++) begin
      @(posedge clk);
      plaintext <= i;  // block tăng dần (0x00...00, 0x00...01, ...)
    end

    // Giữ input ổn định sau khi cấp xong
    @(posedge clk);
    plaintext <= 128'hxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx;

    // Đợi pipeline đẩy hết dữ liệu ra
    repeat(20) @(posedge clk);

    $display("=== Simulation Done ===");
    $finish;
  end

endmodule
